sudo: false

language:
  - ruby

rvm:
  - "2.5"

install:
  - bundle install --without debug:development

script:
  - bundle exec rake test
  - ./tools.rb setup-environment configs/katello/3.14.yaml
  - ./tools.rb cherry-picks configs/katello/3.14.yaml
  - ./tools.rb changelog configs/katello/3.14.yaml

deploy:
  provider: releases
  api_key: $GITHUB_ACCESS_TOKEN
  file:
    - cherry_picks_*
    - repos/katello/**/katello/CHANGELOG.md
  skip_cleanup: true
  on:
    tags: true
    branch: autotool
